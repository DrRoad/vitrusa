"0","bd <- tn %>%"
"0","  select(KSSL.Project.lab, KSSL.Project.name, UserPedonID, labsampno, layerID, Comp, Cover_kind, Crop,  Mgmt, Soil, hor_desg, hor_top, hor_bot, Prop, Value) %>%"
"0","  filter(str_detect(Prop, ""BD"")) %>%"
"0","  spread(Prop, Value) "
"0","bd2 <- bd %>%"
"0","  left_join("
"0","    tn %>% "
"0","        select(KSSL.Project.lab, KSSL.Project.name, UserPedonID, labsampno, layerID, Comp, Cover_kind, Crop,  Mgmt, Soil, hor_desg, hor_top, hor_bot, Prop, Value)%>% "
"0","      filter(Prop %in% c(""Clay"", ""Tot_C"", ""CaCarb"")) %>%  spread(Prop, Value))"
"0","    "
"0","#Order of bulk density selection - change order if desired"
"0","bd_1 <- ""BD_Clod_13"""
"0","bd_2 <- ""BD_3inCore"""
"0","bd_4 <- ""BD_compcav"""
"0","bd_3 <- ""BD_4inCore"""
"0","#create new data element that combines all bulk density methods'"
"0","bd2 <- bd2 %>%"
"0","  mutate(BD = ifelse(!is.na(get(bd_1)), get(bd_1),"
"0","    ifelse(!is.na(get(bd_2)), get(bd_2), "
"0","      ifelse(!is.na(get(bd_3)),get(bd_3),           "
"0","        ifelse(!is.na(get(bd_4)), get(bd_4),             "
"0","           NA))))"
"0","    )"
"0","  "
"0","#if you need to seperate by year"
"0","# bd2$BD <- ifelse(bd2$Date == ""2015"", "
"0","#                               as.numeric("
"0","#   ifelse(!is.na(bd2[,bd_1]), bd2[,bd_1],"
"0","#     ifelse(!is.na(bd2[,bd_2]), bd2[,bd_2],"
"0","#     ifelse(!is.na(bd2[,bd_3]), bd2[,bd_3],           "
"0","#     ifelse(!is.na(bd2[,bd_4]), bd2[,bd_4],             "
"0","#            NA"
"0","#   ))))), "
"0","#       as.numeric("
"0","#       ifelse(!is.na(bd2[,bd_1]), bd2[,bd_1],"
"0","#         ifelse(!is.na(bd2[,bd_2]), bd2[,bd_2],"
"0","#         ifelse(!is.na(bd2[,bd_3]), bd2[,bd_3],           "
"0","#         ifelse(!is.na(bd2[,bd_4]), bd2[,bd_4],             "
"0","#                NA"
"0","#       )))))"
"0","# )"
"0","#pedon bd avg"
"0","pedBD <- bd2 %>%"
"0","  group_by(UserPedonID) %>%"
"0","  summarise(ped_avg = mean(BD, na.rm=T))"
"0","# add ped avg bd"
"0","bd2 <- left_join(bd2, pedBD) %>%"
"0","  mutate(BulkDensity = as.numeric(ifelse(is.na(BD), ped_avg, BD) ))"
"0"," "
"0","#add source description Comp"
"0","bd2 <- bd2 %>%"
"0","  mutate(bd_source =ifelse(!is.na(get(bd_1)), bd_1,"
"0","    ifelse(!is.na(get(bd_2)), bd_2,"
"0","      ifelse(!is.na(get(bd_3)),bd_3,           "
"0","        ifelse(!is.na(get(bd_4)), bd_4,             "
"0","     ""ped_avg""))))"
"0","  )"
"0"," "
"0","table(bd2$bd_source)"
"1","
"
"1","BD_Clod_13 "
"1","
"
"1","        34 "
"1","
"
"0","summary(bd2$BulkDensity)"
"1","   Min. "
"1","1st Qu. "
"1"," Median "
"1","   Mean "
"1","3rd Qu. "
"1","   Max. "
"1","
"
"1","  1.386 "
"1","  1.464 "
"1","  1.523 "
"1","  1.518 "
"1","  1.564 "
"1","  1.662 "
"1","
"
"0","ggplot(bd2, aes(y = BulkDensity, x = Comp)) + geom_boxplot(aes(fill = bd_source))"
