---
title: "Region 11 SDJR Progress for Wisconsin"
output: word_document
---

For the past several years Soil Survey Offices in the East Central Glaciated Region (11) have focused their work on the Soil Data Join and Recorrelation (SDJR) National Initiative. The goal of this Initiative has been to increase the consistency of the Soil SURvey GeOgraphic database (SSURGO) across political boundaries. A summary of the affected areas in Wisconin are presented below.


```{r, echo=FALSE, warning=FALSE, message=FALSE, results='asis', fig.height=5}
setwd("C:/workspace")
options(stringsAsFactors = FALSE)

library(knitr)
library(plyr)
library(lattice)
library(foreign)
library(raster)
library(rgdal)
library(RColorBrewer)

st <- "WI"

load(file = "corrs_fy_summary.Rdata")
load(file = "goals_fy_summary.Rdata")
load(file = "ssa.Rdata")


corrs$state <- substr(corrs$areasymbol, 1, 2)
corrs_sub <- subset(corrs, region == 11 & state == st)

corrs2<- ddply(corrs_sub, .(fy, state, projectname, new_muname), summarize, n = length(unique(new_acres)), acres = paste0(unique(new_acres), collapse = ", "))
corrs2 <- ddply(corrs2, .(fy, state, projectname, new_muname, n), summarize, acres = sum(as.numeric(strsplit(acres, ", ")[[1]])))
corrs2$acres <- as.numeric(corrs2$acres)


test <- ddply(corrs2, .(fy), summarize, acres = formatC(sum(acres), format = "fg", big.mark = ","))
# test2 <- reshape(test, idvar = "state", v.names = "acres", timevar = "fy", direction = "wide")
# fy <- c("FY2013", "FY2014", "FY2015")
# names(test2)[2:4] <- fy


test2 <- ddply(corrs2, .(fy, state, projectname, acres), summarize, comp = unlist(lapply(strsplit(new_muname, ", "), function(x) x[1])))
test2 <- ddply(test2, .(fy, state, projectname, acres), summarize, comp = unlist(lapply(strsplit(comp, " "), function(x) x[1])))
test2 <- ddply(test2, .(fy, state, projectname, acres), summarize, comp = unlist(lapply(strsplit(comp, "-"), function(x) x)))
test2 <- ddply(test2, .(fy, comp), summarize, acres = sum(as.numeric(acres)))
test2 <- ddply(test2, .(fy), summarize, soil_series = na.exclude(c(list(comp[1:5]))))

test3 <- join(test, test2, by = "fy")
names(test3) <- c("Fiscal Year", "Updated Acres", "Top 5 Soil Series Updated in Wisconsin")
kable(test3, align = "c")


### Summarize acres by areasymbol

corrs2 <- ddply(corrs_sub, .(fy, region, projectname, project_type, sso, areasymbol), summarize, n = length(unique(new_acres)), acres = paste0(unique(new_acres), collapse = ", "))
corrs2 <- ddply(corrs2, .(fy, region, sso, projectname, project_type, areasymbol, n), summarize, acres = sum(as.numeric(strsplit(acres, ", ")[[1]])))
corrs2$acres <- as.numeric(corrs2$acres)

corrs_sub <- subset(corrs2, region == 11 & project_type == "SDJR")
corrs_sub$st <- substr(corrs_sub$areasymbol, 1, 2)
goals_sub <- subset(goals, Region == 11 & project_type == "SDJR")
#test3 <- ddply(goals_sub, .(fy), summarize, acres = sum(Reported))


test <- ddply(corrs_sub, .(fy, areasymbol), summarize, acres = sum(acres))
test2 <- reshape(test, idvar = c("areasymbol"), v.names = "acres", timevar = "fy", direction = "wide")
fy <- paste0("FY", sort(unique(test$fy)))
names(test2)[2:(length(fy)+1)] <- fy

ssa$state <- substr(ssa$areasymbol, 1, 2)

test3 <- join(data.frame(ssa), test2, by = "areasymbol")
ssa@data <- test3
temp <- subset(ssa, state == "WI")
temp2 <- temp[fy]
spplot(temp2, main = "Time Series of Updated Acres by County", cuts = 4, col.regions = brewer.pal(5, "Spectral"))
```
